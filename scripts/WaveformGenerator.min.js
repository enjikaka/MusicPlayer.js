function BufferLoader(o,e,r){this.context=o,this.urlList=e,this.onload=r,this.bufferList=[],this.loadCount=0}function Waveform(o,e,r,a,t,n,w,i){t=parseInt(t),n=parseFloat(n),a=void 0!==a?a:"black",window.waveformCanvas.width=e,window.waveformCanvas.height=r,window.waveformBarWidth=t,window.waveformBarGap=n,window.waveformBarAlign=parseInt(w),window.waveformBarColor=a,window.retFunc=i,window.svg=document.createElement("svg"),window.svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),window.svg.setAttribute("version","1.1");var d=document.createElement("style");d.setAttribute("type","text/css");var f=document.createTextNode("<![CDATA[path{stroke:"+a+";stroke-width:"+(0!==t?t*Math.abs(1-n):t)+"}]]>");d.appendChild(f),window.svg.appendChild(d),window.svg.setAttribute("viewBox","0 0 "+e+" "+r);var v=new BufferLoader(window.waveformContext,[o],function(o){var e=window.waveformContext.createBufferSource();e.buffer=o[0],window.waveformBuffer=o[0],Waveform.bufferExtract(window.waveformCanvas.width)});v.load()}window.waveformCanvas=document.createElement("canvas"),window.waveformCanvasContext=window.waveformCanvas.getContext("2d"),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.waveformContext=new AudioContext,window.waveformBarWidth=1,window.waveformBarGap=0,window.waveformBarAlign=0,window.svg=null,BufferLoader.prototype.loadBuffer=function(o,e){var r=new XMLHttpRequest;r.open("GET",o,!0),r.responseType="arraybuffer";var a=this;r.onload=function(){a.context.decodeAudioData(r.response,function(r){return r?(a.bufferList[e]=r,++a.loadCount==a.urlList.length&&a.onload(a.bufferList),void 0):(console.error("Error decoding file data: "+o),void 0)},function(o){console.error("DecodeAudioData error",o)})},r.onerror=function(){console.error("BufferLoader: XHR error")},r.send()},BufferLoader.prototype.load=function(){for(var o=0;o<this.urlList.length;++o)this.loadBuffer(this.urlList[o],o)},Waveform.bufferExtract=function(o){for(var e=window.waveformBuffer.getChannelData(0),r=Math.floor(e.length/o),a=0;o>a;a+=window.waveformBarWidth){var t=a*r;Waveform.drawBar(a,Waveform.bufferMeasure(t,t+r,e))}a>=o&&window.retFunc(window.waveformCanvas.toDataURL(),"data:image/svg+xml;base64,"+btoa('<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">')+btoa(window.svg.outerHTML))},Waveform.bufferMeasure=function(o,e,r){for(var a,t=0,n=o,a=e-1;a>=o?a>=n:n>=a;a>=o?n++:n--)t+=Math.pow(r[n],2);return Math.sqrt(t/r.length)},Waveform.drawBar=function(o,e){var r=window.waveformCanvasContext;r.fillStyle=window.waveformBarColor;var a=40*e*window.waveformCanvas.height,t=window.waveformBarWidth;0!==window.waveformBarGap&&(t*=Math.abs(1-window.waveformBarGap));var n=o+t/2,w=window.waveformCanvas.height-a,i=document.createElement("path");return w=1!==window.waveformBarAlign?window.waveformCanvas.height/2-a/2:w,i.setAttribute("d","M"+n+" "+w+" L"+parseFloat(n)+" "+w+" L"+n+" "+parseFloat(w+a)+" L"+n+" "+parseFloat(w+a)+" L"+n+" "+w+" Z"),window.svg.appendChild(i),r.fillRect(o,w,t,a)};