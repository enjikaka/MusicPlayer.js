function BufferLoader(e,o,r){this.context=e,this.urlList=o,this.onload=r,this.bufferList=new Array,this.loadCount=0}function WaveformGenerator(e,o,r,t,a){localStorage.setItem("color",t),window.waveformCanvas.width=o,window.waveformCanvas.height=r,window.retFunc=a,window.waveformContext=new AudioContext;var n=new BufferLoader(window.waveformContext,[e],function(e){var o=window.waveformContext.createBufferSource();o.buffer=e[0],window.waveformBuffer=e[0],WaveformGenerator.bufferExtract(window.waveformCanvas.width,WaveformGenerator.drawBar)});n.load()}window.waveformCanvas=document.createElement("canvas"),window.waveformCanvasContext=window.waveformCanvas.getContext("2d"),window.AudioContext=window.AudioContext||window.webkitAudioContext,BufferLoader.prototype.loadBuffer=function(e,o){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer";var t=this;r.onload=function(){t.context.decodeAudioData(r.response,function(r){return r?(t.bufferList[o]=r,++t.loadCount==t.urlList.length&&t.onload(t.bufferList),void 0):(alert("error decoding file data: "+e),void 0)},function(e){console.error("decodeAudioData error",e)})},r.onerror=function(){alert("BufferLoader: XHR error")},r.send()},BufferLoader.prototype.load=function(){for(var e=0;e<this.urlList.length;++e)this.loadBuffer(this.urlList[e],e)},WaveformGenerator.bufferExtract=function(e,o){var r,t=window.waveformBuffer.getChannelData(0),a=Math.floor(t.length/e),n=0,f=function(){var f,i,w;for(f=n+10,w=[];f>n;){if(i=n*a,o(n,WaveformGenerator.bufferMeasure(i,i+a,t)),n++,n>=e){clearInterval(r);break}w.push(void 0)}return n==e&&window.retFunc(window.waveformCanvas.toDataURL()),w};return r=setInterval(f,1)},WaveformGenerator.bufferMeasure=function(e,o,r){var t,a,n,f=0;for(t=e,n=o-1;n>=e?n>=t:t>=n;n>=e?t++:t--)a=r[t],f+=a*a;return Math.sqrt(f/r.length)},WaveformGenerator.drawBar=function(e,o){var r=window.waveformCanvasContext,t=localStorage.getItem("color");r.fillStyle=void 0!==t?t:"black";var a;return a=50*o*window.waveformCanvas.height,r.fillRect(e,window.waveformCanvas.height/2-a/2,1,a)};
//# sourceMappingURL=WaveformGenerator.min.js.map