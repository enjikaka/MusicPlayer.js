function BufferLoader(e,o,t){this.context=e,this.urlList=o,this.onload=t,this.bufferList=[],this.loadCount=0}function Waveform(e,o,t,r,a,n,w,i){window.AudioContext=window.AudioContext||window.webkitAudioContext,a=parseInt(a),n=parseFloat(n),r=void 0!==r?r:"black",window.waveformCanvas.width=o,window.waveformCanvas.height=t,window.waveformBarWidth=a,window.waveformBarGap=n,window.waveformBarAlign=parseInt(w),window.waveformBarColor=r,window.retFunc=i,window.svg=document.createElement("svg"),window.svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),window.svg.setAttribute("version","1.1");var d=document.createElement("style");d.setAttribute("type","text/css");var f=document.createTextNode("<![CDATA[path{stroke:"+r+";stroke-width:"+(0!==a?a*Math.abs(1-n):a)+"}]]>");d.appendChild(f),window.svg.appendChild(d),window.svg.setAttributeNS("http://www.w3.org/2000/svg","viewBox","0 0 "+o+" "+t),window.waveformContext=new AudioContext;var v=new BufferLoader(window.waveformContext,[e],function(e){var o=window.waveformContext.createBufferSource();o.buffer=e[0],window.waveformBuffer=e[0],Waveform.bufferExtract(window.waveformCanvas.width,Waveform.drawBar)});v.load()}window.waveformCanvas=document.createElement("canvas"),window.waveformCanvasContext=window.waveformCanvas.getContext("2d"),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.waveformBarWidth=1,window.waveformBarGap=0,window.waveformBarAlign=0,window.svg=null,BufferLoader.prototype.loadBuffer=function(e,o){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer";var r=this;t.onload=function(){r.context.decodeAudioData(t.response,function(t){return t?(r.bufferList[o]=t,++r.loadCount==r.urlList.length&&r.onload(r.bufferList),void 0):(console.error("Error decoding file data: "+e),void 0)},function(e){console.error("DecodeAudioData error",e)})},t.onerror=function(){console.error("BufferLoader: XHR error")},t.send()},BufferLoader.prototype.load=function(){for(var e=0;e<this.urlList.length;++e)this.loadBuffer(this.urlList[e],e)},Waveform.bufferExtract=function(e,o){var t,r=window.waveformBuffer.getChannelData(0),a=Math.floor(r.length/e),n=0,w=function(){for(var w,i,d=a;d>n;)if(w=n*a,o(n,Waveform.bufferMeasure(w,w+a,r)),n+=window.waveformBarWidth,n>=e){clearInterval(t);break}return n==e&&window.retFunc(window.waveformCanvas.toDataURL(),"data:image/svg+xml;base64,"+btoa(window.svg.outerHTML)),i};return t=setInterval(w,1)},Waveform.bufferMeasure=function(e,o,t){var r,a,n,w=0;for(r=e,n=o-1;n>=e?n>=r:r>=n;n>=e?r++:r--)a=t[r],w+=a*a;return Math.sqrt(w/t.length)},Waveform.drawBar=function(e,o){var t=window.waveformCanvasContext;t.fillStyle=window.waveformBarColor;var r=50*o*window.waveformCanvas.height,a=window.waveformBarWidth;0!==window.waveformBarGap&&(a*=Math.abs(1-window.waveformBarGap));var n=e+a/2,w=window.waveformCanvas.height-r,i=document.createElement("path");return 1===window.waveformBarAlign?i.setAttribute("d","M"+n+" "+w+" L"+parseFloat(n)+" "+w+" L"+n+" "+parseFloat(w+r)+" L"+n+" "+parseFloat(w+r)+" L"+n+" "+w+" Z"):(w=window.waveformCanvas.height/2-r/2,i.setAttribute("d","M"+n+" "+w+" L"+parseFloat(n)+" "+w+" L"+n+" "+parseFloat(w+r)+" L"+n+" "+parseFloat(w+r)+" L"+n+" "+w+" Z")),window.svg.appendChild(i),t.fillRect(e,w,a,r)};