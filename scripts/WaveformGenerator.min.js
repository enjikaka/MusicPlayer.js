function BufferLoader(e,o,r){this.context=e,this.urlList=o,this.onload=r,this.bufferList=[],this.loadCount=0}function Waveform(e,o,r,t,a,n,w,i){t=void 0!==t?t:"black",window.waveformCanvas.width=o,window.waveformCanvas.height=r,window.waveformBarWidth=parseInt(a),window.waveformBarGap=parseFloat(n),window.waveformBarAlign=parseInt(w),window.waveformBarColor=t,window.retFunc=i,window.svg=document.createElement("svg"),window.svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),window.svg.setAttribute("version","1.1");var d=document.createElement("style");d.setAttribute("type","text/css");var f=document.createTextNode("<![CDATA[path{stroke:"+t+";stroke-width:"+(0!==a?a*Math.abs(1-n):a)+"}]]>");d.appendChild(f),window.svg.appendChild(d),window.svg.setAttributeNS(null,"viewBox","0 0 "+o+" "+r);var v=new BufferLoader(window.waveformContext,[e],function(e){var o=window.waveformContext.createBufferSource();o.buffer=e[0],window.waveformBuffer=e[0],Waveform.bufferExtract(window.waveformCanvas.width)});v.load()}window.waveformCanvas=document.createElement("canvas"),window.waveformCanvasContext=window.waveformCanvas.getContext("2d"),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.waveformContext=new AudioContext||new webkitAudioContext,window.waveformBarWidth=1,window.waveformBarGap=0,window.waveformBarAlign=0,window.svg=null,BufferLoader.prototype.loadBuffer=function(e,o){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer";var t=this;r.onload=function(){t.context.decodeAudioData(r.response,function(r){return r?(t.bufferList[o]=r,++t.loadCount==t.urlList.length&&t.onload(t.bufferList),void 0):(console.error("Error decoding file data: "+e),void 0)},function(e){console.error("DecodeAudioData error",e)})},r.onerror=function(){console.error("BufferLoader: XHR error")},r.send()},BufferLoader.prototype.load=function(){for(var e=0;e<this.urlList.length;++e)this.loadBuffer(this.urlList[e],e)},Waveform.bufferExtract=function(e){for(var o=window.waveformBuffer.getChannelData(0),r=Math.floor(o.length/e),t=0;e>t;t+=window.waveformBarWidth){var a=t*r;Waveform.drawBar(t,Waveform.bufferMeasure(a,a+r,o))}t>=e&&window.retFunc(window.waveformCanvas.toDataURL(),URL.createObjectURL(new Blob(['<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+window.svg.outerHTML],{type:"image/svg+xml"})))},Waveform.bufferMeasure=function(e,o,r){var t,a,n=0;for(a=e,t=o-1;t>=e?t>=a:a>=t;t>=e?a++:a--)n+=Math.pow(r[a],2);return Math.sqrt(n/r.length)},Waveform.drawBar=function(e,o){var r=window.waveformCanvasContext;r.fillStyle=window.waveformBarColor;var t=40*o*window.waveformCanvas.height,a=window.waveformBarWidth;0!==window.waveformBarGap&&(a*=Math.abs(1-window.waveformBarGap));var n=e+a/2,w=window.waveformCanvas.height-t,i=document.createElement("path");return w=1!==window.waveformBarAlign?window.waveformCanvas.height/2-t/2:w,i.setAttribute("d","M"+n+" "+w+" L"+n+" "+w+" L"+n+" "+(w+t)+" L"+n+" "+(w+t)+" L"+n+" "+w+" Z"),window.svg.appendChild(i),r.fillRect(e,w,a,t)};